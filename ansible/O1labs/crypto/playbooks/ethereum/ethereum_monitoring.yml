---
- name: Provision instance monitoring services
  hosts: monitored
  roles:
    - role: "../../roles/monitoring"
      vars:
        target_services: [ 'node-exporter' ]

- name: Setup Prometheus observability service
  hosts: prometheus
  roles:
    - role: "../../roles/monitoring"
      vars:
        target_services: [ 'prometheus' ]
        monitored_services: [ 'geth', 'geth-exporter' ]
        prometheus_scrape_configs:
          - job_name: "prometheus"
            static_configs:
              - targets: ["prometheus:9090"]
          - job_name: "ethereum"
            metrics_path: "/debug/metrics/prometheus"
            static_configs:
              - targets: ["geth:4000", "openethereum:3300"]
          - job_name: "geth-exporter"
            static_configs:
              - targets: ["geth-exporter:9090"]
          - job_name: "node-exporter"
            static_configs:
              - targets: ["node-exporter:9100"]
          
- name: Setup Grafana observability service
  hosts: grafana
  roles:
    - role: "../../roles/monitoring"
      vars:
        target_services: [ 'grafana' ]
